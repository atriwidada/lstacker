{
  "name": "Lstacker",
  "tagline": "A virtual network infrastructure builder.",
  "body": "# LStacker\r\n\r\nThe LStacker project is a virtual network and infrastructure builder. It builds a virtual container based network on top of the infrastructure supplied to it. Using this approach enables an organisation to quickly build infrastructure on minimul hardware, in and out of the cloud. Thus maximizing investement.\r\n\r\n## Approach\r\nLStacker is designed to use a simple build approach to infrastructure setup as detailed below:\r\n\r\n* A simple Yaml configuration file is used to define the network and server infrastructure that will be built.\r\n* Infrasture is built on top of simple vanilla VM's or Cloud instances. And can easily be rebuilt at any stage. [Ubuntu](http://www.ubuntu.com/) 16.04 is a requirement at present.\r\n* [LXD](https://linuxcontainers.org/lxd/) is used to build out the server container infrastucture.\r\n* [Docker](https://www.docker.com/) is fully supported and docker swarm can be used to bring up complex applications.\r\n* A virtual network using a GRE/VxLAN bridge enables all containers to communicate with each other across the infrastructure. Be they on one or multiple servers. Openvswitch is used to manage this network.\r\n* The virtual network is normally divided into the following components:\r\n    * Management network: This network is setup to enable the management processes to communicate with the containers. This will be used by monitoring processes such as check_mk, or by the dns server.\r\n    * Test network: This network is used for test purposes. If you want to play around with technology use this network.\r\n    * Development network: This is used for development purposes.\r\n    * QA network: A network for QA purposes\r\n    * Production network: A network for production purposes.\r\n* A jump-box is built as a means to access the virtual network. Use [sshuttle](http://sshuttle.readthedocs.io/) to setup a VPN like connection into the jump-box and then access all the virtual infrastructure as if you were on the network. Multiple jump-boxes can be built if horizontal loading within the network is a requirement.\r\n* Production instances can be exposed through the jump-box by configuring port mappings and haproxy.\r\n* Recipes are used to build the containers and custom recipies can easily be written and executed. This means server infrastructure can be built to match your requirements.\r\n* A base set of recipies are supplied; they include jenkins, mysql, postgres, apache, haproxy, salt, omd etc.\r\n\r\n## Instastructure\r\nI recommend running on a minum of 4 either virtual machines or cloud instances. These you can allocate as you see fit in your Lstacker build file. If you are worried about the costs then use micro instances on EC2 will work, but more may have to be allocated. This will not cause a problem with the build process. If cost is not a factor than I recommend a medium instance or higher.\r\n\r\n1. Install vanilla version of [Ubuntu](http://www.ubuntu.com/download/server) 16.04 onto the target virtual machines or cloud instances.\r\n2. Ear mark a virtual machine or instance as the master server and setup ssh key based access from it to the other instances.\r\n3. Clone this project and add it to the PATH environment variable on the master server.\r\n\r\n## System setup\r\nEach VM or cloud instance needs to be updated as follows.\r\n```\r\nsudo apt update\r\nsudo apt upgrade -y\r\nsudo apt install lxd openvswitch-switch -y\r\nsudo reboot\r\n```\r\n\r\n## Hostname configuration\r\nMake sure the hosts names are configured correctly. This is not a requirement but will reduce the amount of warnings that will come to the console. To do this follow these steps:\r\n\r\n1. Edit the host name file with your editor of choice for example `sudo vi /etc/hostname`. Set the hostname to \r\n2. Edit the hosts file and add the hostname of choice to the loop back ip entra. `sudo vi /etc/hosts` \r\n3. Set the hostname for the running instance by running the host command. `sudo hostname <host name>`\r\n\r\n## LXD Setup\r\nLXD/LXC has to be configured appropriatly. This requires running the `lxd init` command. This has to be peformed on all boxes. Select the configuration that makes the most sense for your environment. I recommend running on a ZFS pool, if this is not available than a standard dir backend will work fine.\r\n\r\n## Openvswitch\r\nOpenvswitch has to be installed on all hosts. This can be done through apt as follows:\r\n\r\n```sudo apt install openvswitch-switch```\r\n\r\n## Build Process\r\n\r\n1. Setup a lstacker context directory.\r\n2. Write a `lstacker.yaml` file defining the network and infrastructure. There are example provided with this project.\r\n3. Build the infrastructure\r\n   `lstacker stack`\r\n\r\n## Example steps\r\nAn example of what needs to be one to use LStacker correctly.\r\n\r\n```\r\ngit clone https://github.com/brettchaldecott/lstacker.git\r\nPATH=$PATH:`pwd`/lstacker\r\nexport PATH\r\nmkdir lstacker-context\r\ncd lstacker-context\r\ncp ../lstacker/examples/ec2-small-lstacker.yml lstacker.yml\r\nvi lstacker.yaml\r\n# Edit the file to match your build requirements\r\n.\r\n.\r\n# put the private key refered to in the lstacker.yaml file in the lstacker-context directory\r\ncp \"private key\"\r\n.\r\n# build a public key file containing all the keys you wish to access the infrastructure\r\n# it is also refered to in the lstacker.yml file\r\n.\r\n# run the lstacker command\r\nlstacker stack\r\n```\r\n\r\nTo clean up simply run the unstack command\r\n```\r\nlstacker unstack\r\n```\r\n\r\n## Access the network\r\nOnce a network has been built it can be accessed by sshing directly to the jump-box or more efficently by using [sshuttle](http://sshuttle.readthedocs.io/).\r\n\r\nTo ssh directly to the jump box use the following command:\r\n```\r\nssh -i private_key_file -p 10022 ubuntu@hostname_or_ip_of_master\r\n```\r\n\r\nTo setup and use sshuttle use the following command\r\n```\r\nsshuttle -r ubuntu@hostname_or_ip_of_master 10.0.0.0/8 -e \"ssh -p 10022 -i key_file\"\r\n```\r\n\r\nOnce the sshuttle connection is established you will be able to ssh directly to any of the severs in the network you have built. For ip address or hostname information refer to the hosts file directory within the lstacker-context directory. This contains the hostnames and ip addresses for all servers built within the infrastructure.\r\n\r\n",
  "note": "Don't delete this file! It's used internally to help with page regeneration."
}